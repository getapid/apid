---
version: 1
variables:
  api_url: http://localhost:80
transactions:
  - id: authenticated-transaction
    steps:
      - id: auth
        variables:
          auth: "am9obi5kb2U6UGE1NXdvcmQ="
        request:
          method: POST
          endpoint: "{{ var.api_url }}/auth"
          headers:
            Authorization: "Basic {{ var.auth }}"
        export:
          auth_token: "response.body.token"
        response:
          code: 200
          exact: false

      - id: get-beers
        request:
          method: GET
          endpoint: "{{ var.api_url }}/beer"
          headers:
            Authorization: "Bearer {{ auth.auth_token }}"
        response:
          code: 200
          exact: false

      - id: get-beer-1
        request:
          method: GET
          endpoint: "{{ var.api_url }}/beer/1"
          headers:
            Authorization: "Bearer {{ auth.auth_token }}"
        response:
          code: 200
          body:
            exact: true
            type: json
            content: |
              {
                "beer": {
                  "id": 1,
                  "name": "Stella Artois",
                  "type": "pilsner",
                  "price": 2.5
                }
              }

  - id: simple-transaction
    steps:
      - id: health-endpoint-test-get
        request:
          method: GET
          endpoint: "{{ var.api_url }}/health"
        response:
          code: 200
          body:
            type: "plaintext"
            content: "OK"
            exact: true

      - id: echo-endpoint-test-post
        request:
          method: POST
          endpoint: "{{ var.api_url }}/echo"
          body: "some text h3re"
        response:
          code: 200
          body:
            type: "plaintext"
            content: "some text h3re"
            exact: true
